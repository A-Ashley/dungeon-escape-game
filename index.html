<!DOCTYPE html>
<html lang="en">
<head>
  <title>Vampire Zombie Dungeon Escape</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="https://pyscript.net/releases/2023.05.1/pyscript.css" />
  <script defer src="https://pyscript.net/releases/2023.05.1/pyscript.js"></script>
  <style>
    input, button {
      margin-top: 10px;
      padding: 8px;
      font-size: 16px;
      background-color: #222;
      color: #e82e2e;
      border: 1px solid #ff4c4c;
    }
    body {
      background: linear-gradient(to bottom, #013220, #000000);
      color: #ff4c4c;
      font-family: 'Courier New', monospace;
      padding: 20px;
	  text-align: center;
    }
    #game-output {
      background-color: rgba(0, 0, 0, 0.7);
      border: 2px solid #ff4c4c;
      padding: 15px;
      margin-top: 10px;
      box-shadow: 0 0 10px #ff4c4c;
      min-height: 200px;
    }
  </style>
</head>
<body>
    <h1> Vampire Zombie </h1>
	<h1> Dungeon Escape </h1>
	
	
    <input id="player-name" type="text" placeholder="Enter your name" />
    <button id="start-button">Start Game</button>

    <div id="game-output"></div>
	
    <input id="user-input" type="text" placeholder="Type a direction or 'Get'" style="display:none;" />
    <button id="submit-button" style="display:none;">Submit</button>

	
  <py-script>
from js import document
from pyscript import Element
from pyodide.ffi import create_proxy

rooms = {
    'Prison': {'West': 'Guard Room'},
    'Guard Room': {'East': 'Prison', 'South': 'Library', 'item': 'a sword'},
    'Bed Chambers': {'South': 'Entrance', 'item': 'boots'},
    'Library': {'North': 'Guard Room', 'East': 'Kitchen', 'West': 'Entrance', 'South': 'Armory', 'item': 'a book'},
    'Entrance': {'East': 'Library', 'North': 'Bed Chambers', 'item': 'a cool sticker'},
    'Kitchen': {'North': 'Storage', 'West': 'Library', 'item': 'coffee'},
    'Storage': {'South': 'Kitchen', 'item': 'stakes'},
    'Armory': {'North': 'Library', 'East': 'Trophy Room', 'item': 'a shield'},
    'Trophy Room': {'West': 'Armory'}
}

current_room = 'Prison'
inventory = []
items_needed = ['a sword', 'a book', 'coffee', 'stakes', 'a cool sticker', 'boots', 'a shield']
moves = ['North', 'East', 'South', 'West']
player_name = ""

def start_game(event=None):
    global player_name
    player_name = document.getElementById("player-name").value

    document.getElementById("user-input").style.display = "inline-block"
    document.getElementById("submit-button").style.display = "inline-block"

    Element("game-output").element.innerHTML = f"""
    <p>Welcome, {player_name}!</p>
    <p>You were captured by a vampire zombie. Escape the dungeon and collect all items to survive.</p>
    <p>Available moves: North, South, East, West. Type 'Get' to collect items. Type 'Exit' to quit.</p>
    <p><strong>You are in the Prison.</strong></p>
    """

def game_step(event=None):
    global current_room
    move = document.getElementById("user-input").value.capitalize()
    output = ""

    if move == "Exit":
        current_room = "Prison"
        inventory.clear()

        document.getElementById("user-input").style.display = "none"
        document.getElementById("submit-button").style.display = "none"
        document.getElementById("player-name").style.display = "inline-block"
        document.getElementById("start-button").style.display = "inline-block"

        output = f"~ Thank you for playing, {player_name}! ~<br>"
        output += "You may enter your name and click Start Game to play again."

        Element("game-output").element.innerHTML = output
        return

    if move == "Get":
        if 'item' in rooms[current_room]:
            item = rooms[current_room].pop('item')
            inventory.append(item)
            output += f"You picked up {item}.<br>"
        else:
            output += "There are no items in this room.<br>"
    elif move in rooms[current_room]:
        current_room = rooms[current_room][move]
        output += f"You moved to <strong>{current_room}</strong>.<br>"
    elif move in moves:
        output += "You can't go that way from here.<br>"
    else:
        output += "Invalid command.<br>"

    if current_room == "Trophy Room":
        if set(inventory) == set(items_needed):
            output += "<br><strong>You have all the items!</strong><br>"
            output += "You slay the vampire zombie and escape victorious! <br>"
        else:
            output += "<br><strong>Oh no!</strong><br>"
            output += "You were unprepared and met your demise... <br>"
        
        current_room = "prison"
        inventory.clear()
        document.getElementById("user-input").style.display = "none"
        document.getElementById("submit-button").style.display = "none"
        document.getElementById("player-name").style.display = "inline-block"
        document.getElementById("start-button").style.display = "inline-block"
        document.getElementById("user-input").value = ""
        output += f"<br>~ Game Over, {player_name}! ~<br>Click Start Game to play again."
        Element("game-output").element.innerHTML = output
        return

        output += f"<br><strong>You are in the {current_room}.</strong><br>"

    if 'item' in rooms[current_room]:
        output += f"You see {rooms[current_room]['item']}. Type 'Get' to pick it up.<br>"

    directions = [key for key in rooms[current_room] if key in moves]
    output += f"Available directions: {', '.join(directions)}<br>"
    output += f"Inventory: {', '.join(inventory)}<br>"

    Element("game-output").element.innerHTML = output
    document.getElementById("user-input").value = ""

start_game_proxy = create_proxy(start_game)
document.getElementById("start-button").addEventListener("click", start_game_proxy)

game_step_proxy = create_proxy(game_step)
document.getElementById("submit-button").addEventListener("click", game_step_proxy)
  </py-script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
      .then(() => console.log('Service Worker registered'))
      .catch(error => console.error('Service Worker registration failed:', error));
  }
</script>
</body>

</html>
